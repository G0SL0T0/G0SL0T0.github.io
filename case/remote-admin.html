<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Admin Remote Installer</title>
  <style>
    :root{
      --bg:#f5f5f5;
      --card:#fff;
      --accent:#007bff;
      --text:#222;
    }
    *{box-sizing:border-box;margin:0;padding:0;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    body{background:var(--bg);color:var(--text);padding:1rem}
    .app{width:100%;display:flex;flex-direction:column;gap:1rem}
    .controls{display:flex;gap:1rem;flex-wrap:wrap}
    select,button{padding:.5rem .75rem;border:none;border-radius:0}
    select{background:#e0e0e0}
    button{background:var(--accent);color:#fff;cursor:pointer}
    .host-grid{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      gap:1rem;
    }
    .host{
      background:var(--card);
      border:1px solid #ccc;
      padding:1rem;
      display:flex;
      flex-direction:column;
      gap:.5rem;
    }
    .host .ip{font-size:.9rem;color:#555}
    .ping{font-weight:bold}
    .bar{height:4px;background:#ddd;margin-top:.25rem}
    .bar div{height:100%;background:var(--accent)}
    .log{background:#111;color:#0f0;font-family:monospace;padding:.5rem;max-height:200px;overflow-y:auto}
  </style>
</head>
<body>
  <div class="app">
    <h1>Admin Remote Installer</h1>

    <!-- Управление -->
    <div class="controls">
      <select id="playbook">
        <option value="nginx.yml">nginx.yml</option>
        <option value="sap.yml">sap.yml</option>
        <option value="docker.yml">docker.yml</option>
      </select>
      <button onclick="runPlaybook()">Запустить</button>
    </div>

    <!-- 12 хостов -->
    <div class="host-grid" id="hostGrid"></div>

    <!-- Логи -->
    <div class="log" id="log"></div>
  </div>

<script>
  const hosts = [
    {id:'h01',name:'srv-01',ip:'192.168.1.10'},
    {id:'h02',name:'srv-02',ip:'192.168.1.11'},
    {id:'h03',name:'srv-03',ip:'192.168.1.12'},
    {id:'h04',name:'srv-04',ip:'192.168.1.13'},
    {id:'h05',name:'srv-05',ip:'192.168.1.14'},
    {id:'h06',name:'srv-06',ip:'192.168.1.15'},
    {id:'h07',name:'srv-07',ip:'192.168.1.16'},
    {id:'h08',name:'srv-08',ip:'192.168.1.17'},
    {id:'h09',name:'srv-09',ip:'192.168.1.18'},
    {id:'h10',name:'sap-01',ip:'192.168.1.20'},
    {id:'h11',name:'sap-02',ip:'192.168.1.21'},
    {id:'h12',name:'db-01',ip:'192.168.1.30'}
  ];

  let spikeHost = null;

  function renderHosts(){
    const grid = document.getElementById('hostGrid');
    grid.innerHTML = hosts.map(h => `
      <div class="host" id="${h.id}">
        <div>${h.name}</div>
        <div class="ip">${h.ip}</div>
        <div class="ping" id="ping-${h.id}">-- ms</div>
        <div class="bar"><div id="bar-${h.id}"></div></div>
      </div>
    `).join('');
  }

  function updatePing(){
    // сброс спайка
    if (spikeHost && Math.random() > 0.5) spikeHost = null;

    // выбор нового для спайка
    if (!spikeHost && Math.random() < 0.15) spikeHost = hosts[Math.floor(Math.random()*hosts.length)];

    hosts.forEach(h=>{
      let ping = 40 + Math.floor(Math.random()*11); // 40-50
      if (h === spikeHost) ping *= 2;
      const avail = Math.max(0,100-ping);
      document.getElementById(`ping-${h.id}`).textContent = ping + ' ms';
      document.getElementById(`bar-${h.id}`).style.width = avail + '%';
    });
  }
  setInterval(updatePing, 5000 + Math.random()*5000);

  function runPlaybook(){
    const pb = document.getElementById('playbook').value;
    const log = document.getElementById('log');
    log.innerHTML = `ansible-playbook ${pb} -l all\n`;
    const steps = [
      'TASK [Gathering Facts] *** ok',
      'TASK [Install package] *** changed',
      'PLAY RECAP ok=12 changed=12 failed=0'
    ];
    let i=0;
    const t = setInterval(()=>{
      log.insertAdjacentHTML('beforeend', steps[i] + '<br>');
      i++;
      if (i>=steps.length) clearInterval(t);
    },600);
  }

  renderHosts();
</script>
</body>
</html>